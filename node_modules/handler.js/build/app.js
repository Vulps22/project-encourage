"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var pathMatch = require('path-match');
var const_1 = require("./const");
var util_1 = require("./util");
var _createMatch = pathMatch();
var Application = (function () {
    function Application() {
        this._middlewares = [];
        this._routes = [];
    }
    Application.prototype._addRoute = function (method, path, handler) {
        var route = {
            handler: handler,
            match: _createMatch(path),
            method: method,
            path: path,
        };
        this._routes.push(route);
    };
    Application.prototype._rewritePath = function (path) {
        path = util_1.removePrefix(path);
        var result = path
            .replace(/(\/+)/g, '/')
            .replace(/\/((?:\?.*)?)$/, '$1')
            .replace(/^([^/]|$)/, '/$1');
        // Handle non-empty path prefix case
        if (const_1.PATH_PREFIX !== '' && result === '/') {
            result = '';
        }
        if (result !== path) {
            return "" + const_1.PATH_PREFIX + result;
        }
        return null;
    };
    return Application;
}());
exports.Application = Application;
